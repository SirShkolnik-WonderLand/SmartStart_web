<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - AliceSolutionsGroup</title>
    <meta name="robots" content="noindex, nofollow">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="assets/css/admin-dashboard.css">
    <style>
        /* Booking Analytics Styles */
        
        .booking-stat {
            border-left: 4px solid #3b82f6;
        }
        
        .admin-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .refresh-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }
        
        .refresh-btn:hover {
            background: #2563eb;
        }
        
        .bookings-container {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1rem;
        }
        
        .bookings-table-container {
            overflow-x: auto;
        }
        
        .bookings-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        
        .bookings-table th {
            background: rgba(59, 130, 246, 0.1);
            padding: 1rem 0.75rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 2px solid var(--glass-border);
        }
        
        .bookings-table td {
            padding: 1rem 0.75rem;
            border-bottom: 1px solid var(--glass-border);
            color: var(--text-secondary);
        }
        
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-confirmed {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }
        
        .status-pending {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }
        
        .status-cancelled {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .action-btn {
            background: none;
            border: 1px solid var(--glass-border);
            padding: 0.5rem;
            border-radius: 6px;
            cursor: pointer;
            margin: 0 0.25rem;
            transition: all 0.3s ease;
        }
        
        .action-btn:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
        }
        
        .loading-cell,
        .error-cell,
        .empty-cell {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        .error-cell {
            color: #ef4444;
        }
        
        @media (max-width: 768px) {
            .bookings-table {
                font-size: 0.8rem;
            }
            .bookings-table th,
            .bookings-table td {
                padding: 0.75rem 0.5rem;
            }
            .admin-section-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
        }
    </style>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="assets/css/footer-lean.css">
</head>

<body>
    <!-- Unified Header -->
    <div id="header"></div>

    <!-- Admin Header -->
    <header class="admin-header">
        <div class="admin-header-content">
            <div class="admin-logo">
                <img src="assets/images/AliceSolutionsGroup-logo-owl-rabbit-fox.png" alt="AliceSolutionsGroup" class="admin-logo-image">
                <span>Admin Dashboard</span>
            </div>
            <div class="admin-nav">
                <a href="index.html" class="admin-nav-link">‚Üê Back to Site</a>
                <span class="admin-status" id="adminStatus">üü¢ Live</span>
            </div>
        </div>
    </header>

    <!-- Admin Main Content -->
    <main class="admin-main">
        <!-- Dashboard Overview -->
        <section class="admin-section">
            <div class="admin-container">
                <h1 class="admin-title">Website Analytics Dashboard</h1>
                <p class="admin-subtitle">Real-time insights for AliceSolutionsGroup website performance</p>
                <div class="data-status-indicator">
                    <span class="status-badge">üîí Real Data Only</span>
                </div>

                <!-- Quick Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-content">
                            <h3 class="stat-number" id="totalVisitors">0</h3>
                            <p class="stat-label">Total Visitors</p>
                            <span class="stat-change positive" id="visitorChange">+0%</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üåç</div>
                        <div class="stat-content">
                            <h3 class="stat-number" id="uniqueCountries">0</h3>
                            <p class="stat-label">Countries</p>
                            <span class="stat-change neutral" id="countryChange">+0</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìÑ</div>
                        <div class="stat-content">
                            <h3 class="stat-number" id="pageViews">0</h3>
                            <p class="stat-label">Page Views</p>
                            <span class="stat-change positive" id="pageViewChange">+0%</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è±Ô∏è</div>
                        <div class="stat-content">
                            <h3 class="stat-number" id="avgSessionTime">0m</h3>
                            <p class="stat-label">Avg. Session</p>
                            <span class="stat-change positive" id="sessionChange">+0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Booking Analytics -->
        <section class="admin-section">
            <div class="admin-container">
                <h2 class="section-title">üìÖ Booking Analytics</h2>
                <p class="section-subtitle">Consultation bookings and conversion metrics</p>

                <div class="stats-grid">
                    <div class="stat-card booking-stat">
                        <div class="stat-icon">üìÖ</div>
                        <div class="stat-content">
                            <h3 class="stat-number" id="totalBookings">0</h3>
                            <p class="stat-label">Total Bookings</p>
                        </div>
                    </div>
                    <div class="stat-card booking-stat">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-content">
                            <h3 class="stat-number" id="confirmedBookings">0</h3>
                            <p class="stat-label">Confirmed</p>
                        </div>
                    </div>
                    <div class="stat-card booking-stat">
                        <div class="stat-icon">üîÑ</div>
                        <div class="stat-content">
                            <h3 class="stat-number" id="pendingBookings">0</h3>
                            <p class="stat-label">Pending</p>
                        </div>
                    </div>
                    <div class="stat-card booking-stat">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-content">
                            <h3 class="stat-number" id="conversionRate">0%</h3>
                            <p class="stat-label">Conversion Rate</p>
                        </div>
                    </div>
                </div>

                <!-- Recent Bookings -->
                <div class="admin-section-header">
                    <h3 class="admin-section-title">üìã Recent Bookings</h3>
                    <button class="refresh-btn" onclick="loadBookingData()">üîÑ Refresh</button>
                </div>

                <div class="bookings-container">
                    <div class="bookings-table-container">
                        <table class="bookings-table" id="bookingsTable">
                            <thead>
                                <tr>
                                    <th>Date & Time</th>
                                    <th>Type</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="bookingsTableBody">
                                <tr>
                                    <td colspan="6" class="loading-cell">Loading bookings...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Geographic Analytics -->
        <section class="admin-section">
            <div class="admin-container">
                <h2 class="section-title">Geographic Distribution</h2>
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3 class="card-title">Top Countries</h3>
                        <div class="country-list" id="topCountries">
                            <div class="loading">Loading country data...</div>
                        </div>
                    </div>
                    <div class="analytics-card">
                        <h3 class="card-title">Top Cities</h3>
                        <div class="city-list" id="topCities">
                            <div class="loading">Loading city data...</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Page Analytics -->
        <section class="admin-section">
            <div class="admin-container">
                <h2 class="section-title">Page Performance</h2>
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3 class="card-title">Most Visited Pages</h3>
                        <div class="page-list" id="topPages">
                            <div class="loading">Loading page data...</div>
                        </div>
                    </div>
                    <div class="analytics-card">
                        <h3 class="card-title">Traffic Sources</h3>
                        <div class="source-list" id="trafficSources">
                            <div class="loading">Loading source data...</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SEO Analytics -->
        <section class="admin-section">
            <div class="admin-container">
                <h2 class="section-title">SEO & Search Analytics</h2>
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3 class="card-title">Search Keywords</h3>
                        <div class="keyword-list" id="searchKeywords">
                            <div class="loading">Loading keyword data...</div>
                        </div>
                    </div>
                    <div class="analytics-card">
                        <h3 class="card-title">Referral Sites</h3>
                        <div class="referral-list" id="referralSites">
                            <div class="loading">Loading referral data...</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Device & Browser Analytics -->
        <section class="admin-section">
            <div class="admin-container">
                <h2 class="section-title">Device & Browser Analytics</h2>
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3 class="card-title">Device Types</h3>
                        <div class="device-list" id="deviceTypes">
                            <div class="loading">Loading device data...</div>
                        </div>
                    </div>
                    <div class="analytics-card">
                        <h3 class="card-title">Browser Usage</h3>
                        <div class="browser-list" id="browserUsage">
                            <div class="loading">Loading browser data...</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Performance Metrics -->
        <section class="admin-section">
            <div class="admin-container">
                <h2 class="section-title">Performance Metrics</h2>
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3 class="card-title">Core Web Vitals</h3>
                        <div class="metrics-grid">
                            <div class="metric-item">
                                <span class="metric-label">LCP</span>
                                <span class="metric-value" id="lcpValue">Loading...</span>
                                <span class="metric-unit">ms</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">FID</span>
                                <span class="metric-value" id="fidValue">Loading...</span>
                                <span class="metric-unit">ms</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">CLS</span>
                                <span class="metric-value" id="clsValue">Loading...</span>
                                <span class="metric-unit">score</span>
                            </div>
                        </div>
                    </div>
                    <div class="analytics-card">
                        <h3 class="card-title">Page Performance</h3>
                        <div class="metrics-grid">
                            <div class="metric-item">
                                <span class="metric-label">Load Time</span>
                                <span class="metric-value" id="loadTime">Loading...</span>
                                <span class="metric-unit">ms</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">DOM Ready</span>
                                <span class="metric-value" id="domReady">Loading...</span>
                                <span class="metric-unit">ms</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">First Paint</span>
                                <span class="metric-value" id="firstPaint">Loading...</span>
                                <span class="metric-unit">ms</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SEO Analytics -->
        <section class="admin-section">
            <div class="admin-container">
                <h2 class="section-title">SEO Analytics</h2>
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3 class="card-title">Page Structure</h3>
                        <div class="metrics-grid">
                            <div class="metric-item">
                                <span class="metric-label">H1 Tags</span>
                                <span class="metric-value" id="h1Count">Loading...</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">H2 Tags</span>
                                <span class="metric-value" id="h2Count">Loading...</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Images</span>
                                <span class="metric-value" id="imageCount">Loading...</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Word Count</span>
                                <span class="metric-value" id="wordCount">Loading...</span>
                            </div>
                        </div>
                    </div>
                    <div class="analytics-card">
                        <h3 class="card-title">Link Analysis</h3>
                        <div class="metrics-grid">
                            <div class="metric-item">
                                <span class="metric-label">Internal Links</span>
                                <span class="metric-value" id="internalLinks">Loading...</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">External Links</span>
                                <span class="metric-value" id="externalLinks">Loading...</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Total Links</span>
                                <span class="metric-value" id="totalLinks">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Booking Management -->
        <section class="admin-section">
            <div class="admin-container">
                <h2 class="section-title">Training Booking Management</h2>
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3 class="card-title">Recent Bookings</h3>
                        <div class="booking-list" id="recentBookings">
                            <div class="loading">Loading booking data...</div>
                        </div>
                        <div class="booking-actions">
                            <button class="action-btn primary" onclick="refreshBookings()">üîÑ Refresh Bookings</button>
                            <button class="action-btn secondary" onclick="exportBookings()">üìä Export Bookings</button>
                        </div>
                    </div>
                    <div class="analytics-card">
                        <h3 class="card-title">Booking Statistics</h3>
                        <div class="metrics-grid">
                            <div class="metric-item">
                                <span class="metric-label">Total Bookings</span>
                                <span class="metric-value" id="totalBookings">0</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Pending</span>
                                <span class="metric-value" id="pendingBookings">0</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Confirmed</span>
                                <span class="metric-value" id="confirmedBookings">0</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">This Month</span>
                                <span class="metric-value" id="monthlyBookings">0</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3 class="card-title">Service Popularity</h3>
                        <div class="service-stats" id="serviceStats">
                            <div class="loading">Loading service statistics...</div>
                        </div>
                    </div>
                    <div class="analytics-card">
                        <h3 class="card-title">Booking Actions</h3>
                        <div class="booking-management">
                            <div class="management-actions">
                                <button class="action-btn primary" onclick="viewAllBookings()">üìã View All Bookings</button>
                                <button class="action-btn secondary" onclick="manageAvailability()">üìÖ Manage Availability</button>
                                <button class="action-btn secondary" onclick="sendReminders()">üìß Send Reminders</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- User Behavior -->
        <section class="admin-section">
            <div class="admin-container">
                <h2 class="section-title">User Behavior</h2>
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3 class="card-title">Interaction Tracking</h3>
                        <div class="metrics-grid">
                            <div class="metric-item">
                                <span class="metric-label">Mouse Movements</span>
                                <span class="metric-value" id="mouseMovements">Loading...</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Focus Events</span>
                                <span class="metric-value" id="focusEvents">Loading...</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Form Interactions</span>
                                <span class="metric-value" id="formInteractions">Loading...</span>
                            </div>
                        </div>
                    </div>
                    <div class="analytics-card">
                        <h3 class="card-title">Device Information</h3>
                        <div class="metrics-grid">
                            <div class="metric-item">
                                <span class="metric-label">Screen Resolution</span>
                                <span class="metric-value" id="screenResolution">Loading...</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Color Depth</span>
                                <span class="metric-value" id="colorDepth">Loading...</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Device Memory</span>
                                <span class="metric-value" id="deviceMemory">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Real-time Activity -->
        <section class="admin-section">
            <div class="admin-container">
                <h2 class="section-title">Real-time Activity</h2>
                <div class="analytics-card full-width">
                    <h3 class="card-title">Live Visitors</h3>
                    <div class="live-activity" id="liveActivity">
                        <div class="loading">Loading live activity...</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Export & Actions -->
        <section class="admin-section">
            <div class="admin-container">
                <h2 class="section-title">Data Management</h2>
                <div class="action-buttons">
                    <button class="action-btn primary" onclick="exportData()">üìä Export Analytics</button>
                    <button class="action-btn secondary" onclick="refreshData()">üîÑ Refresh Data</button>
                    <button class="action-btn secondary" onclick="clearOldData()">üóëÔ∏è Clear Old Data</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Admin Footer -->
    <!-- Footer -->
    <div id="footer"></div>

    <script src="assets/js/admin-dashboard.js"></script>
    <script src="assets/js/load-components.js"></script>
    <script src="assets/js/script.js"></script>

    <!-- Booking Analytics Script -->
    <script>
        // Load booking data from the API
        async function loadBookingData() {
            try {
                const response = await fetch('/api/booking/analytics/overview');
                const data = await response.json();

                // Update booking stats
                document.getElementById('totalBookings').textContent = data.totalBookings || 0;
                document.getElementById('confirmedBookings').textContent = data.confirmedBookings || 0;
                document.getElementById('pendingBookings').textContent = data.pendingBookings || 0;
                document.getElementById('conversionRate').textContent = data.conversionRate || '0%';

                // Load recent bookings
                await loadRecentBookings();

            } catch (error) {
                console.error('Error loading booking data:', error);
                // Show error state
                document.getElementById('bookingsTableBody').innerHTML =
                    '<tr><td colspan="6" class="error-cell">Error loading bookings. Please try again.</td></tr>';
            }
        }

        // Load recent bookings
        async function loadRecentBookings() {
            try {
                const response = await fetch('/api/booking/recent');
                const bookings = await response.json();

                const tableBody = document.getElementById('bookingsTableBody');

                if (bookings.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="6" class="empty-cell">No bookings found.</td></tr>';
                    return;
                }

                tableBody.innerHTML = bookings.map(booking => {
                    const date = new Date(booking.consultationTime);
                    const statusClass = booking.status === 'confirmed' ? 'status-confirmed' :
                        booking.status === 'cancelled' ? 'status-cancelled' : 'status-pending';

                    return `
                        <tr>
                            <td>${date.toLocaleDateString()} ${date.toLocaleTimeString()}</td>
                            <td>${booking.type || 'Consultation'}</td>
                            <td>${booking.firstName} ${booking.lastName}</td>
                            <td>${booking.email}</td>
                            <td><span class="status-badge ${statusClass}">${booking.status || 'pending'}</span></td>
                            <td>
                                <button class="action-btn view-btn" onclick="viewBooking('${booking.id}')">üëÅÔ∏è</button>
                                <button class="action-btn confirm-btn" onclick="confirmBooking('${booking.id}')">‚úÖ</button>
                            </td>
                        </tr>
                    `;
                }).join('');

            } catch (error) {
                console.error('Error loading recent bookings:', error);
                document.getElementById('bookingsTableBody').innerHTML =
                    '<tr><td colspan="6" class="error-cell">Error loading bookings.</td></tr>';
            }
        }

        // View booking details
        function viewBooking(bookingId) {
            // Implement booking details modal
            alert(`View booking details for ID: ${bookingId}`);
        }

        // Confirm booking
        async function confirmBooking(bookingId) {
            try {
                const response = await fetch(`/api/booking/confirm/${bookingId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    alert('Booking confirmed successfully!');
                    loadBookingData(); // Refresh data
                } else {
                    alert('Error confirming booking');
                }
            } catch (error) {
                console.error('Error confirming booking:', error);
                alert('Error confirming booking');
            }
        }

        // Load booking data when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadBookingData();
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            loadNavbar();
            loadFooter();
        });
    </script>
</body>

</html>